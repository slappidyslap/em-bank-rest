# Card Management System Backend

## Обзор

Backend-приложение, разработанное на Spring Boot, предназначенное для управления
банковскими картами, пользователями и операциями перевода. Система реализует
ролевую модель доступа (ADMIN и USER) с использованием аутентификации на базе JWT

## Ключевые возможности и ролевой доступ

### Пользователь - USER
* **Просмотр Карт:** Постраничный просмотр и фильтрация только своих карт
* **Баланс:** Просмотр текущего баланса по картам
* **Переводы:** Совершение переводов средств между своими картами
* **Блокировка:** Запрос на блокировку своей карты
* **Профиль:** Просмотр и редактирование личных данных

### Администратор - ADMIN
* **Карты:** Полный CRUD-функционал (создание, активация, блокировка, удаление) для всех карт в системе
* **Пользователи:** Управление учетными записями пользователей
* **Обзор:** Просмотр всех карт и всех пользователей в системе

### Безопасность
* **Аутентификация:** Spring Security + JWT + Refresh Token
* **Авторизация:** Ролевой доступ (ADMIN и USER) к конечным точкам
* **Шифрование:** Номера карт шифруются перед сохранением в базу данных [с помощью алгоритма с помощью алгоритма AES](./src/main/java/kg/musabaev/em_bank_rest/util/SomePaymentSystemProvider.java)
* **Маскирование:** Номера карт, выдаваемые через API, маскируются. Например: `**** **** **** 1234`

## Технологический стек

* **Язык:** Java 21
* **Фреймворк:** Spring Boot
* **База данных:** PostgreSQL
* **Безопасность:** Spring Security, JWT
* **Миграции БД:** Liquibase
* **Контейнеризация:** Docker, Docker Compose
* **Маппинг:** MapStruct
* **Документация:** OpenAPI, Swagger

## Запуск проекта

### Запуск через Docker Compose

### Требования
1.  Установленный Docker и Docker Compose

Этот метод автоматически поднимет базу данных PostgreSQL 
и запустит Spring Boot приложение, выполнив миграции Liquibase.
Для запуска выполните команду:

```bash
./scripts/docker-compose-up.sh
```
    
API будет доступно по адресу: `http://localhost:8080`.
База данных PostgreSQL будет доступна на порту `5432`.

### Запуск локально без Docker

### Требования
1. Установленный JDK 21
2. Установленный Maven
3. Установленный Docker и Docker Compose

### Запуск

1. Убедитесь, что у вас запущена локальная база данных PostgreSQL
2. Определите переменные окружения для подключения к БД. Не забудьте выполнить команду `export` для каждой переменной в вашей текущей сессии терминала
3. Запустите приложение с помощью команды:

```bash
export DB_HOST=localhost
export DB_PORT=5432
export DB_USERNAME=postgres
export DB_PASSWORD=1 
./mvnw spring-boot:run -P dev
```

## Документация API

После успешного запуска проекта документация OpenAPI доступна по адресу:

**Swagger UI:** `http://localhost:8080/swagger-ui.html`

Здесь вы найдете все эндпоинты для аутентификации, регистрации, управления пользователями, картами и переводами.

### Базовые Учетные Данные (После миграций Liquibase)

Если миграции Liquibase включают начальные данные, используйте следующие учетные записи для тестирования:

<table>
  <thead>
    <tr>
      <th style="text-align: left;">Роль</th>
      <th style="text-align: left;">Email</th>
      <th style="text-align: left;">Пароль</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ADMIN</td>
      <td>admin@admin.com</td>
      <td>1</td>
    </tr>
    <tr>
      <td>USER</td>
      <td>user@user.com</td>
      <td>1</td>
    </tr>
  </tbody>
</table>

## Тестирование

Проект включает юнит тесты для покрытия ключевой бизнес-логики сервисов и контроллеров

### Запуска всех тесов

```bash
./mvnw test
```

### Отчет по покрытию кода (JaCoCo):

После запуска тестов полный HTML отчет о покрытии кода доступен по следующему пути:
`target/site/jacoco/index.html`

## Полезные ссылки

https://habr.com/ru/articles/818489/

https://stackoverflow.com/questions/27767264/how-to-dockerize-a-maven-project-how-many-ways-to-accomplish-it

https://github.com/jwtk/jjwt?tab=readme-ov-file#quickstart
